<div class="loading-box" *ngIf="loading">
  <div class="content">
    <mat-spinner diameter="72" strokeWidth="10"></mat-spinner>
    <p class="tip" *ngIf="loadingMsg">{{ loadingMsg | translate | async }}</p>
  </div>
</div>

<app-hardware-sign
  *ngIf="showHardwareSign"
  [chainType]="'Neo3'"
  [currentWallet]="currentWallet"
  [unsignedTx]="tx"
  [magicNumber]="n3Network.magicNumber"
  (backWithSignedTx)="handleHardwareSignedTx($event)"
></app-hardware-sign>

<div class="container">
  <div class="header">
    <div class="invoke-type">Â· INVOKE</div>
    <p class="title">
      {{ n3Network.network }}
      {{ "ChainSmartContractDeploy" | translate | async }}
    </p>
    <copy [value]="signAddress">
      <div class="account">
        <img class="avatar" [avatar]="signAddress" />
        <div class="name-group">
          <p class="name">{{ currentWallet.name }}</p>
          <p>{{ signAddress | longStr : 10 }}</p>
        </div>
      </div>
    </copy>
  </div>
  <div class="tabs-container">
    <span
      [class]="{ selected: tabType === 'details' }"
      (click)="tabType = 'details'"
    >
      {{ "details" | translate | async }}
    </span>
    <span [class]="{ selected: tabType === 'data' }" (click)="tabType = 'data'">
      {{ "data" | translate | async }}
    </span>
  </div>
  <div class="content details" *ngIf="tabType === 'details' && invokeParams">
    <div class="request-info">
      <div class="request-info-item">
        <div class="label">
          {{ "InteractingWith" | translate | async }}
          <tooltip
            placement="bottomLeft"
            [tip]="'interactionWithTip' | translate | async"
          >
            <img src="assets/images/common/tooltip.svg" alt="" />
          </tooltip>
        </div>
        <div>
          <copy [value]="invokeParams.scriptHash" placement="left">
            {{
              invokeParams?.contractName
                ? invokeParams.contractName
                : (invokeParams.scriptHash | longStr : 6)
            }}
          </copy>
        </div>
      </div>
      <div class="request-info-item">
        <div class="label">
          {{ "Operation" | translate | async }}
          <tooltip
            placement="bottomLeft"
            [tip]="'operationTip' | translate | async"
          >
            <img src="assets/images/common/tooltip.svg" alt="" />
          </tooltip>
        </div>
        <span>{{ invokeParams.operation }}</span>
      </div>
      <div class="request-info-item">
        <div class="label">
          {{ "InvocationArguments" | translate | async }}
          <tooltip
            placement="bottomLeft"
            [tip]="'InvocationArgumentsTip' | translate | async"
          >
            <img src="assets/images/common/tooltip.svg" alt="" />
          </tooltip>
        </div>
        <img
          class="arrow"
          [ngClass]="{ active: invokeParams.expandArgs }"
          (click)="invokeParams.expandArgs = !invokeParams.expandArgs"
          theme
          src="/assets/images/common/arrow.svg"
          alt=""
        />
      </div>
      <div class="param-list" *ngIf="invokeParams.expandArgs">
        <div
          class="param-item"
          *ngFor="let item of invokeParams.argsObj; index as index"
        >
          <div class="param-label">
            {{ item.name ?? "Param" }} #{{ index + 1 }}
            <tooltip placement="right" [tip]="item.type">
              <img src="assets/images/common/tooltip.svg" alt="" />
            </tooltip>
          </div>
          <span class="param-value">{{ item.value }}</span>
        </div>
      </div>
    </div>
    <div class="request-info">
      <div class="request-info-item">
        <div class="label">
          {{ "signers" | translate | async }}
          <tooltip
            placement="bottomLeft"
            [tip]="'signersTip' | translate | async"
          >
            <img src="assets/images/common/tooltip.svg" alt="" />
          </tooltip>
        </div>
        <img
          class="arrow"
          [ngClass]="{ active: invokeParams.expandSigners }"
          (click)="invokeParams.expandSigners = !invokeParams.expandSigners"
          theme
          src="/assets/images/common/arrow.svg"
          alt=""
        />
      </div>
      <div class="param-list" *ngIf="invokeParams.expandSigners">
        <div class="param-item" *ngFor="let item of invokeParams.signersObj">
          <div class="param-label">{{ item.name }}</div>
          <span class="param-value">{{ item.value }}</span>
        </div>
      </div>
      <div
        class="request-info-item"
        *ngIf="invokeParams?.broadcastOverride !== undefined"
      >
        <div class="label">
          {{ "broadcastOverride" | translate | async }}
          <tooltip
            placement="bottomLeft"
            [tip]="'broadcastOverrideTip' | translate | async"
          >
            <img src="assets/images/common/tooltip.svg" alt="" />
          </tooltip>
        </div>
        <span>
          {{
            (invokeParams.broadcastOverride ? "booleanYes" : "No")
              | translate
              | async
          }}</span
        >
      </div>
    </div>
    <ul>
      <li>
        <p class="label">
          {{ "GASFEE" | translate | async
          }}<img
            class="edit"
            (click)="editFee()"
            src="assets/images/common/edit.svg"
          />
        </p>
        <p class="value">{{ fee | numberFixed }} GAS</p>
        <div class="border-line"></div>
      </li>
      <li>
        <p class="label">{{ "TOTAL" | translate | async }}</p>
        <p class="value dropdown">
          {{ totalFee | numberFixed }} GAS
          <img
            (click)="expandTotalFee = !expandTotalFee"
            class="arrow"
            [ngClass]="{ expand: expandTotalFee }"
            [class.expand]="expandTotalFee"
            src="assets/images/common/support-arrow.svg"
            alt=""
          />
        </p>
        <p class="value-rate">
          {{ totalMoney | numberFixed : 2 }} {{ rateCurrency }}
        </p>
      </li>
      <li [hidden]="!expandTotalFee">
        <p class="label">{{ "SYSTEMFEE" | translate | async }}</p>
        <p class="value">{{ systemFee | numberFixed }} GAS</p>
      </li>
      <li [hidden]="!expandTotalFee">
        <p class="label">{{ "NETWORKFEE" | translate | async }}</p>
        <p class="value">{{ networkFee | numberFixed }} GAS</p>
      </li>
    </ul>
  </div>
  <div class="content data" *ngIf="tabType === 'data'">
    <div class="hex-label n3-invoke">
      HEX
      <copy [value]="txSerialize" placement="right">
        <img class="copy" theme src="assets/images/common/copy.svg" alt="" />
      </copy>
    </div>
    <p class="json-box serialize">{{ txSerialize }}</p>
  </div>
  <div class="btn-group">
    <button class="cancel" (click)="exit()">
      {{ "cancel" | translate | async }}
    </button>
    <button
      class="confirm"
      [ngClass]="{ disabled: !canSend }"
      (click)="confirm()"
    >
      {{ "yes" | translate | async }}
    </button>
  </div>
</div>
